<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เครื่องคำนวณราคายาเบิกจ่ายกรมบัญชีกลาง</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* กำหนด font-family เป็น Inter สำหรับข้อความทั้งหมด */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">
            เครื่องคำนวณราคายาเบิกจ่ายกรมบัญชีกลาง
        </h1>

        <!-- ส่วนสำหรับเลือกประเภทราคา -->
        <div class="mb-5">
            <label class="block text-gray-700 text-sm font-semibold mb-2">
                เลือกประเภทราคา:
            </label>
            <div class="flex items-center space-x-4">
                <label class="inline-flex items-center">
                    <input type="radio" id="excludeVat" name="priceType" value="excludeVat" class="form-radio text-blue-600 rounded-full" checked>
                    <span class="ml-2 text-gray-700">ราคาต้นทุน (ไม่รวม VAT 7%)</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" id="includeVat" name="priceType" value="includeVat" class="form-radio text-blue-600 rounded-full">
                    <span class="ml-2 text-gray-700">ราคาต้นทุน (รวม VAT แล้ว)</span>
                </label>
            </div>
        </div>

        <!-- ส่วนสำหรับกรอกราคาทุนยา -->
        <div class="mb-6">
            <label for="costPrice" class="block text-gray-700 text-sm font-semibold mb-2">
                ราคาทุนยา:
            </label>
            <input
                type="number"
                id="costPrice"
                step="0.01"
                placeholder="กรุณาใส่ราคาทุนยา"
                class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
            />
        </div>

        <!-- ปุ่มสำหรับคำนวณ -->
        <button
            id="calculateBtn"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg w-full focus:outline-none focus:shadow-outline transition duration-200 transform hover:scale-105 shadow-md hover:shadow-lg"
        >
            คำนวณราคาเบิกจ่าย
        </button>

        <!-- ส่วนแสดงผลลัพธ์ -->
        <div class="mt-8 pt-6 border-t border-gray-200 text-center">
            <h2 class="text-xl font-semibold text-gray-700 mb-2">
                ราคาเบิกจ่ายกรมบัญชีกลาง:
            </h2>
            <p id="reimbursementPrice" class="text-5xl font-extrabold text-green-600 animate-pulse">
                --
            </p>
            <p id="errorMessage" class="text-red-500 text-sm mt-2 hidden">
                กรุณาใส่ราคาทุนยาที่ถูกต้อง
            </p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ดึงองค์ประกอบ DOM ที่จำเป็น
            const costPriceInput = document.getElementById('costPrice');
            const excludeVatRadio = document.getElementById('excludeVat');
            const includeVatRadio = document.getElementById('includeVat');
            const calculateBtn = document.getElementById('calculateBtn');
            const reimbursementPriceDisplay = document.getElementById('reimbursementPrice');
            const errorMessageDisplay = document.getElementById('errorMessage');

            // เพิ่ม Event Listener สำหรับปุ่มคำนวณ
            calculateBtn.addEventListener('click', calculateReimbursement);

            /**
             * ฟังก์ชันหลักสำหรับคำนวณราคาเบิกจ่าย
             */
            function calculateReimbursement() {
                // ซ่อนข้อความแสดงข้อผิดพลาดก่อนเริ่มการคำนวณใหม่
                errorMessageDisplay.classList.add('hidden');
                reimbursementPriceDisplay.classList.remove('animate-pulse'); // หยุด animation ก่อน

                let costPrice = parseFloat(costPriceInput.value);

                // ตรวจสอบว่าราคาทุนยาที่ป้อนเข้ามาเป็นตัวเลขที่ถูกต้องหรือไม่
                if (isNaN(costPrice) || costPrice < 0) {
                    reimbursementPriceDisplay.textContent = '--';
                    errorMessageDisplay.classList.remove('hidden');
                    return;
                }

                let C4; // ตัวแปร C4 แทนราคาต้นทุนที่รวม VAT แล้ว

                // กำหนดค่า C4 ตามประเภทราคาที่ผู้ใช้เลือก
                if (excludeVatRadio.checked) {
                    C4 = costPrice * 1.07; // ถ้าป้อนราคาไม่รวม VAT ให้คำนวณรวม VAT 7%
                } else {
                    C4 = costPrice; // ถ้าป้อนราคารวม VAT แล้ว ใช้ค่านั้นโดยตรง
                }

                let reimbursementValue; // ตัวแปรสำหรับเก็บค่าราคาเบิกจ่ายที่คำนวณได้

                /**
                 * ฟังก์ชันช่วยคำนวณค่าพื้นฐาน (ส่วนที่ซ้ำกันในสูตร Excel)
                 * @param {number} val ค่า C4 ที่ใช้ในการคำนวณ
                 * @returns {number} ค่าพื้นฐานที่ได้จากการคำนวณ
                 */
                function calculateBaseValue(val) {
                    if (val <= 0.2) {
                        return 0.5;
                    } else if (val <= 0.5) {
                        return 1;
                    } else if (val <= 1) {
                        return 1.5;
                    } else {
                        // สูตร 1.5 + 1.25*(C4-1) สำหรับค่า C4 > 1
                        return 1.5 + 1.25 * (val - 1);
                    }
                }

                // คำนวณค่าพื้นฐาน
                const baseVal = calculateBaseValue(C4);

                // ตรวจสอบช่วงค่าของ C4 เพื่อกำหนดเงื่อนไขการปัดเศษ (CEILING)
                if (C4 <= 1) {
                    // ถ้า C4 น้อยกว่าหรือเท่ากับ 1 ไม่มีการปัดเศษด้วย CEILING
                    reimbursementValue = baseVal;
                } else if (C4 <= 10) {
                    // ถ้า C4 อยู่ในช่วง (1, 10] ปัดเศษขึ้นเป็นทวีคูณของ 0.25
                    // Math.ceil(x / significance) * significance เพื่อจำลอง CEILING(x, significance)
                    reimbursementValue = Math.ceil(baseVal / 0.25) * 0.25;
                } else if (C4 <= 100) {
                    // ถ้า C4 อยู่ในช่วง (10, 100] ปัดเศษขึ้นเป็นทวีคูณของ 0.5
                    reimbursementValue = Math.ceil(baseVal / 0.5) * 0.5;
                } else {
                    // ถ้า C4 มากกว่า 100 ปัดเศษขึ้นเป็นทวีคูณของ 1
                    reimbursementValue = Math.ceil(baseVal / 1) * 1;
                }

                // แสดงผลลัพธ์โดยกำหนดทศนิยม 2 ตำแหน่ง
                reimbursementPriceDisplay.textContent = reimbursementValue.toFixed(2);
                reimbursementPriceDisplay.classList.add('animate-pulse'); // เพิ่ม animation กลับเข้ามา
            }
        });
    </script>
</body>
</html>